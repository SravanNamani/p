<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Sugarcane Stall Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
* { box-sizing: border-box; }
body {
  margin: 0;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  background: #f1f5f9;
}
.container {
  max-width: 420px;
  margin: auto;
  padding: 14px;
}
.card {
  background: #fff;
  border-radius: 14px;
  padding: 14px;
  margin-bottom: 12px;
  box-shadow: 0 10px 22px rgba(0,0,0,0.12);
}
h1 {
  text-align: center;
  color: #166534;
  margin: 6px 0 10px;
}
label {
  font-size: 14px;
  font-weight: 600;
}
input, select {
  width: 100%;
  padding: 12px;
  margin-top: 6px;
  border-radius: 10px;
  border: 1px solid #ccc;
  font-size: 16px;
}
button {
  width: 100%;
  padding: 12px;
  margin-top: 10px;
  border: none;
  border-radius: 10px;
  background: #16a34a;
  color: #fff;
  font-size: 16px;
  font-weight: 700;
}
button.secondary {
  background: #334155;
}
.summary {
  text-align: center;
}
.profit {
  font-size: 22px;
  font-weight: 800;
}
.positive { color: #15803d; }
.negative { color: #b91c1c; }

.row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 6px;
  padding: 6px 0;
  border-bottom: 1px dashed #cbd5e1;
  font-size: 13px;
}
.small-btn {
  font-size: 12px;
  padding: 6px 8px;
  border-radius: 8px;
  background: #e5e7eb;
  color: #111827;
  border: none;
}
.hidden { display: none; }
.note {
  font-size: 12px;
  color: #475569;
  text-align: center;
}
</style>
</head>

<body>
<div class="container">

<h1>ü•§ Sugarcane Stall</h1>

<!-- HISTORY -->
<div class="card">
  <button class="secondary" onclick="openHistory()">
    üìú History / Data
  </button>
</div>

<script>
function openHistory() {
  window.open(
    "https://docs.google.com/spreadsheets/d/1_pyL9FabvYQSYCcINz5_Hm_GwULsOqYcVTGEhuv1AWw/edit?usp=sharing",
    "_blank"
  );
}
</script>

<!-- ENTRY -->
<div class="card">
  <label>Day</label>
  <select id="date">
    <option value="">-- Select Day --</option>
    <option>27 Feb (Day-1)</option>
    <option>28 Feb (Day-2)</option>
  </select>

  <label style="margin-top:8px;">Time Slot</label>
  <select id="hour">
    <option value="">-- Select Slot --</option>
    <option>3 PM - 4 PM</option>
    <option>4 PM - 5 PM</option>
    <option>5 PM - 6 PM</option>
    <option>6 PM - 7 PM</option>
    <option>7 PM - 8 PM</option>
    <option>8 PM - 9 PM</option>
    <option>9 PM - 10 PM</option>
  </select>

  <label style="margin-top:8px;">Amount (‚Çπ)</label>
  <input type="number" id="amount" placeholder="Enter amount" />

  <button onclick="addSale()">Add Entry</button>
</div>

<!-- SUMMARY -->
<div class="card summary">
  <h2>Total Sales: ‚Çπ <span id="totalSales">0</span></h2>
  <div id="profit" class="profit negative">Profit/Loss: ‚Çπ -30000</div>
  <div class="note">Investment: ‚Çπ30,000</div>
</div>

<div class="card">
  <button class="secondary" onclick="exportCSV()">üì§ Export to Excel</button>
</div>

</div>

<!-- ===================== -->
<!-- HIDDEN GOOGLE FORM   -->
<!-- ===================== -->
<form id="googleForm"
  action="https://docs.google.com/forms/d/e/1FAIpQLSf5xgA01P-VcwdXSfNNk71kFqMXuhERidRbQJfpxsCoKu27nw/formResponse"
  method="POST"
  target="hidden_iframe">

  <!-- CONFIRMED ENTRY IDs -->
  <input type="hidden" name="entry.1912479552" id="formDay">
  <input type="hidden" name="entry.684636906"  id="formSlot">
  <input type="hidden" name="entry.1268963248" id="formAmount">
</form>
<iframe name="hidden_iframe" style="display:none;"></iframe>

<script>
/* ======================
   CONFIG
====================== */
const INVESTMENT = 30000;
const STORAGE_KEY = "sugarcane_sales_form";

/* ======================
   STATE
====================== */
let data = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
let totalSales = 0;

/* ======================
   HELPERS
====================== */
function saveLocal() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
}

function toggleHistory() {
  historySection.classList.toggle("hidden");
}

/* ======================
   CORE LOGIC
====================== */
function addSale() {
  if (!dateSel.value || !hourSel.value || !amountInput.value) {
    alert("Select day, time slot and enter amount");
    return;
  }

  // // lock: one slot per day
  // const exists = data.find(
  //   d => d.date === dateSel.value && d.hour === hourSel.value
  // );
  // if (exists) {
  //   alert("This slot is already entered.\nEdit from History.");
  //   return;
  // }

  const entry = {
    date: dateSel.value,
    hour: hourSel.value,
    amount: Number(amountInput.value)
  };

  // save locally
  data.push(entry);
  saveLocal();

  // background Google Form submit
  document.getElementById("formDay").value = entry.date;
  document.getElementById("formSlot").value = entry.hour;
  document.getElementById("formAmount").value = entry.amount;
  document.getElementById("googleForm").submit();

  render();

  // // auto-next slot
  // const idx = hourSel.selectedIndex;
  // if (idx < hourSel.options.length - 1) {
  //   hourSel.selectedIndex = idx + 1;
  // } else {
  //   hourSel.selectedIndex = 0;
  // }

  // amountInput.value = "";
}

function editEntry(i) {
  const newAmount = prompt("Edit final amount:", data[i].amount);
  if (newAmount !== null && !isNaN(newAmount)) {
    data[i].amount = Number(newAmount);
    saveLocal();

    // audit-safe: push edited value to form as new response
    document.getElementById("formDay").value = data[i].date;
    document.getElementById("formSlot").value = data[i].hour + " (Edited)";
    document.getElementById("formAmount").value = data[i].amount;
    document.getElementById("googleForm").submit();

    render();
  }
}

function render() {
  historyList.innerHTML = "";
  totalSales = 0;

  data.forEach((d, i) => {
    totalSales += d.amount;
    const row = document.createElement("div");
    row.className = "row";
    row.innerHTML = `
      <span>${d.date}</span>
      <span>${d.hour}</span>
      <span>‚Çπ${d.amount}</span>
      <button class="small-btn" onclick="editEntry(${i})">‚úèÔ∏è</button>
    `;
    historyList.appendChild(row);
  });

  totalSalesSpan.innerText = totalSales;
  const profitVal = totalSales - INVESTMENT;
  profitDiv.innerText = "Profit/Loss: ‚Çπ " + profitVal;
  profitDiv.className = profitVal >= 0 ? "profit positive" : "profit negative";
}

function exportCSV() {
  let csv = "Date,Time Slot,Amount\n";
  data.forEach(d => {
    csv += `${d.date},${d.hour},${d.amount}\n`;
  });
  csv += `\nTotal Sales,${totalSales}\nInvestment,${INVESTMENT}\nProfit/Loss,${totalSales - INVESTMENT}`;

  const blob = new Blob([csv], { type: "text/csv" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "sugarcane_sales.csv";
  a.click();
}

/* ======================
   DOM REFS
====================== */
const dateSel = document.getElementById("date");
const hourSel = document.getElementById("hour");
const amountInput = document.getElementById("amount");
const historyList = document.getElementById("historyList");
const historySection = document.getElementById("historySection");
const totalSalesSpan = document.getElementById("totalSales");
const profitDiv = document.getElementById("profit");

/* ======================
   INIT
====================== */
render();
</script>

</body>
</html> 
